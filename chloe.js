"use strict";function Canvas(t,e,i,s,n,o){function r(){if(void 0===i&&(i="canvas"),void 0===t&&(t=600),void 0===e&&(e=400),_chljs.buffer=document.getElementById(i),void 0===_chljs.buffer)_chljs.buffer=document.createElement("canvas"),document.body.appendChild(_chljs.buffer);else if("canvas"!==_chljs.buffer.nodeName.toLowerCase()){var s=_chljs.buffer;_chljs.buffer=document.createElement("canvas"),s.appendChild(_chljs.buffer)}_chljs.buffer.width=t,_chljs.buffer.height=e,_chljs.buffer.style.cursor="url('cursor.png') 8 8, crosshair"}function h(){b.fillStyle=f,b.fillRect(0,0,_chljs.buffer.width,_chljs.buffer.height),void 0!==m?w?Util.fillTile(I,m):Util.fillTile(I,m,-World.cam.x,-World.cam.y):(I.fillStyle=f,I.fillRect(0,0,d.view.width,d.view.height),I.fillStyle="#000"),_chljs.scenes.length?_chljs.scenes[_chljs.currentScene].paint(I):(I.fillText("It's Working!",20,30),I.fillText("Chloe.js 1.0.0",20,50)),Toast.paint(I),_chljs.screenDebug&&u.paint(I),2===s?b.drawImage(d.view,0,0,_chljs.buffer.width,_chljs.buffer.height):b.drawImage(d.view,_chljs.offsetLeft,_chljs.offsetTop,d.view.width*_chljs.viewScale,d.view.height*_chljs.viewScale)}function a(){j(a);var t=Date.now(),e=0,i=0;if(v=(t-y)/1e3,v>1&&(v=0),y=t,p){x+=v;for(var s=g/1e3,n=Input.lastPress,o=Input.lastRelease,r=Input.mouse.move;x>s;){for(_chljs.scenes.length&&_chljs.scenes[_chljs.currentScene].act(s),e=0,i=_chljs.runnable.length;i>e;e+=1)_chljs.runnable[e].update(s);x-=s,_chljs.screenDebug&&(u.aframes+=1),Input.lastPress=null,Input.lastRelease=null,Input.mouse.move=!1}Input.lastPress=n,Input.lastRelease=o,Input.mouse.move=r}else for(_chljs.scenes.length&&_chljs.scenes[_chljs.currentScene].act(v),e=0,i=_chljs.runnable.length;i>e;e+=1)_chljs.runnable[e].update(v);Toast.update(v),_chljs.screenDebug&&(u.frames+=1,u.act(v)),h(),Input.lastPress=null,Input.lastRelease=null,Input.mouse.move=!1}function l(){if((n||o)&&(_chljs.isFullscreen=o&&(t>window.innerWidth||e>window.innerHeight)?!0:n&&screen.width-window.innerWidth<2&&screen.height-window.innerHeight<2?!0:!1),_chljs.isFullscreen){_chljs.buffer.width=window.innerWidth,_chljs.buffer.height=window.innerHeight,_chljs.buffer.style.top="0",_chljs.buffer.style.left="0",_chljs.buffer.style.position="fixed",s>2&&(s%2===0?d.view.height=4!==s||window.innerWidth<window.innerHeight?~~(t*window.innerHeight/window.innerWidth):e:d.view.width=3!==s||window.innerHeight<window.innerWidth?~~(e*window.innerWidth/window.innerHeight):t,window.console&&window.console.log(d.view.width,d.view.height));var i=window.innerWidth/d.view.width,r=window.innerHeight/d.view.height;_chljs.viewScale=1===s?Math.max(r,i):Math.min(r,i),_chljs.offsetLeft=~~((window.innerWidth-d.view.width*_chljs.viewScale)/2),_chljs.offsetTop=~~((window.innerHeight-d.view.height*_chljs.viewScale)/2),document.getElementsByTagName("body")[0].style.overflow="hidden"}else _chljs.viewScale=1,_chljs.offsetLeft=0,_chljs.offsetTop=0,_chljs.buffer.height=e,_chljs.buffer.width=t,_chljs.buffer.style.position="",document.getElementsByTagName("body")[0].style.overflow=""}function c(){d.view=document.createElement("canvas"),d.view.width=t,d.view.height=e,I=d.view.getContext("2d"),b=_chljs.buffer.getContext("2d"),_chljs.view=d.view,World.setSize(t,e),d.onReady(),l(),a()}var u,d=this,f="#ccc",m=null,w=!1,p=!1,g=1e3/60,y=0,v=0,x=0,I=null,b=null,S=!0,j=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,17)}}();_chljs.fullMode=s,void 0===n&&(n=!0),void 0===o&&(o=!0),this.view=null,this.onReady=function(){},this.setBackground=function(t,e,i){void 0!==t?(f=t,m=e,w=void 0===i?!1:i):window.console&&window.console.error("Data missing in Canvas.setBackground(color[, image, fixed])")},this.getAsync=function(){return p},this.setAsync=function(t){p=t},this.toggleAsync=function(){p=!p},this.getFullscreen=function(){return _chljs.isFullscreen},this.setFullscreen=function(t){_chljs.isFullscreen=t},this.toggleFullscreen=function(){_chljs.isFullscreen=!_chljs.isFullscreen},this.getInterval=function(){return p?1e3/g:v},this.setInterval=function(t){g=1e3/t,p=!0},this.getScreenDebug=function(){return _chljs.screenDebug},this.setScreenDebug=function(t){_chljs.screenDebug=t},this.toggleScreenDebug=function(){_chljs.screenDebug=!_chljs.screenDebug},this.getScreenshot=function(){window.open(d.view.toDataURL())},this.loadScene=function(t){_chljs.currentScene=t.id,_chljs.scenes[_chljs.currentScene].load()},this.__defineGetter__("imageSmoothingEnabled",function(){return S}),this.__defineSetter__("imageSmoothingEnabled",function(t){b.webkitImageSmoothingEnabled=t,b.mozImageSmoothingEnabled=t,b.imageSmoothingEnabled=t,S=t}),u=new function(){this.frames=0,this.aframes=0;var t=0,e=0,i="",s=0;i=window.requestAnimationFrame?"dft":window.webkitRequestAnimationFrame?"wkt":window.mozRequestAnimationFrame?"moz":"non",this.act=function(i){s+=i,s>1&&(t=this.frames,e=this.aframes,this.frames=0,this.aframes=0,s-=1)},this.paint=function(s){s.font="10px sans-serif",s.textAlign="center",s.fillStyle="#fff",s.fillText("FPS: "+t,d.view.width/2,10),s.fillText("AFPS: "+e,d.view.width/2,20),s.fillText("AFT: "+i,d.view.width/2,30),s.textAlign="left"}},window.addEventListener("DOMContentLoaded",r,!1),window.addEventListener("load",c,!1),window.addEventListener("resize",l,!1)}function Animation(t,e,i,s){this.images=[],this.currentFrame=0;var n=20,o=0,r=0,h=0,a=0,l=0,c=!1,u=!1;_chljs.runnable.push(this),this.Animation=function(t,e,i,s){return n=void 0===t?20:1e3/t,void 0!==i?(u=!0,this.images.length=0,this.images.push(e),o=i,r=s,!0):(window.console&&window.console.error("Data missing in Animation(framesPerSecond, image, frameWidth[, frameHeight])"),!1)},this.Animation(t,e,i,s),this.addFrame=function(t){void 0!==t?(u=!1,this.images.push(t)):window.console&&window.console.error("Data missing in Animation.addFrame(image)")},this.draw=function(t,e,i,s){if(void 0!==i)if(t.strokeStyle="#0f0",u){var n=this.images[0];isNaN(s)?(t.drawImage(n,o*this.currentFrame,0,o,n.height,e,i,o,n.height),_chljs.screenDebug&&t.strokeRect(e,i,o,n.height)):(t.drawImage(n,o*this.currentFrame,r*s,o,r,e,i,o,r),_chljs.screenDebug&&t.strokeRect(e,i,o,r))}else t.drawImage(this.images[this.currentFrame],e,i),_chljs.screenDebug&&t.strokeRect(e,i,this.images[this.currentFrame].width,this.images[this.currentFrame].height);else window.console&&window.console.error("Data missing in Animation.draw(ctx, x, y[, row])")},this.drawSprite=function(t,e,i,s,n){if(void 0!==e)if(u){i=isNaN(i)?0:i,s=isNaN(s)?0:s;var h=e.hflip?-1:1,a=e.vflip?-1:1,l=this.images[0];t.save(),t.translate(e.x+i-World.cam.x,e.y+s-World.cam.y),t.rotate(e.rotation*Math.DEG),t.scale(e.scale*h,e.scale*a),isNaN(n)?t.drawImage(l,o*this.currentFrame,0,o,l.height,o*-.5,l.height*-.5,o,l.height):t.drawImage(l,o*this.currentFrame,r*n,o,r,o*-.5,r*-.5,o,r),t.restore(),_chljs.screenDebug&&e.drawSprite(t)}else e.drawSprite(t,this.images[this.currentFrame],i,s);else window.console&&window.console.error("Data missing in Animation.drawSprite(ctx, spr[, offsetX, offsetY, row])")},this.getTotalFrames=function(){return u?Math.round(this.images[0].width/o):this.images.length},this.gotoFrame=function(t){isNaN(t)?window.console&&window.console.error("Data missing in Animation.gotoFrame(frame)"):(0>t?t=0:t>this.getTotalFrames()-1&&(t=this.getTotalFrames()-1),this.currentFrame=t,l=0)},this.isPlaying=function(){return c},this.nextFrame=function(){return this.currentFrame+=1,this.currentFrame>this.getTotalFrames()-1&&(this.currentFrame=0),l=0,this.currentFrame},this.prevFrame=function(){return this.currentFrame-=1,this.currentFrame<0&&(this.currentFrame=this.getTotalFrames()-1),l=0,this.currentFrame},this.pause=function(){c=!1},this.play=function(t,e){isNaN(e)||(a=e),isNaN(t)||(h=t,0!==t&&(l=0,this.currentFrame=a%2===1?this.getTotalFrames()-1:0)),c=!0},this.setFPS=function(t){void 0!==t?n=1e3/t:window.console&&window.console.error("Data missing in Animation.setFPS(framesPerSecond)")},this.update=function(t){t=void 0===t?1:t,c&&(a%2===1?l-=t:l+=t,l>n/1e3?(this.currentFrame+=1,this.currentFrame>this.getTotalFrames()-1&&(2===a?(this.currentFrame-=1,a=3):0!==h?(h-=1,0===h?(this.currentFrame-=1,c=!1):this.currentFrame=0):this.currentFrame=0),l-=n/1e3):0>l&&(this.currentFrame-=1,this.currentFrame<0&&(3===a?(this.currentFrame+=1,a=2,0!==h&&(h-=1,0===h&&(c=!1))):0!==h?(h-=1,0===h?(this.currentFrame+=1,c=!1):this.currentFrame=this.getTotalFrames()-1):this.currentFrame=this.getTotalFrames()-1),l+=n/1e3))}}function Button(t,e,i,s){this.x=isNaN(t)?0:t,this.y=isNaN(e)?0:e,this.width=isNaN(i)?0:i,this.height=isNaN(s)?this.width:s}function Camera(t){this.keepInWorld=void 0===t?!0:t}function Particle(t,e,i,s,n,o,r,h){this.x=0,this.y=0,this.ox=0,this.oy=0,this.diameter=0,this.life=0,this.olife=0,this.speed=0,this.angle=0,this.rotation=0,this.color="#000",this.colorList=[],this.Particle(t,e,i,s,n,o,r,h)}function ParticleSystem(){this.gravity=0,this.wind=0,this.moveOrigin=!1,_chljs.runnable.push(this)}function Scene(){this.id=_chljs.scenes.length,_chljs.scenes.push(this)}function Sprite(t,e,i,s,n){this.ox=isNaN(t)?0:t,this.oy=isNaN(e)?0:e,this.ohealth=1,this.width=isNaN(i)?0:i,this.height=isNaN(s)?this.width:s,this.type=isNaN(n)?0:n,this.x=0,this.y=0,this.vx=0,this.vy=0,this.health=0,this.rotation=0,this.scale=1,this.vflip=!1,this.hflip=!1,this.mapOffset=0,this.reset()}function SpriteSheet(t,e,i){this.img=null;var s,n;this.SpriteSheet=function(t,e,i){void 0!==e?(this.img=t,s=e,n=void 0===i?e:i):window.console&&window.console.error("Data missing in SpriteSheet(image, spriteWidth[, _spriteHeight])")},this.SpriteSheet(t,e,i),this.draw=function(t,e,i,o,r){if(void 0!==i){if(o=isNaN(o)?0:o,isNaN(r)&&this.img.width){var h=o*Math.round(this.img.width/s);o>h?(o%=h,r=~~(o/h)):r=0}try{t.drawImage(this.img,o*s,r*n,s,n,e,i,s,n)}catch(a){window.console&&window.console.error(a+" Area: "+o*s+","+r*n+","+s+","+n)}}else window.console&&window.console.error("Data missing in SpriteSheet.draw(ctx, x, y[, col, row])")},this.drawArea=function(t,e,i,s,n,o,r){if(void 0!==r)try{t.drawImage(this.img,s,n,o,r,e,i,o,r)}catch(h){window.console&&window.console.error(h+" Area: "+s+","+n+","+o+","+r)}else window.console&&window.console.error("Data missing in SpriteSheet.drawArea(ctx ,x, y, areaX, areaY, areaWidth, areaHeight)")},this.drawSprite=function(t,e,i,o,r,h){if(void 0!==e){i=isNaN(i)?0:i,r=isNaN(r)?0:r,h=isNaN(h)?0:h;var a=e.hflip?-1:1,l=e.vflip?-1:1;if(isNaN(o)&&this.img.width){var c=Math.round(this.img.width/s);i>c?(i%=c,o=~~(i/c)):o=0}t.save(),t.translate(e.x+r-World.cam.x,e.y+h-World.cam.y),t.rotate(e.rotation*Math.DEG),t.scale(e.scale*a,e.scale*l);try{t.drawImage(this.img,s*i,n*o,s,n,s*-.5,n*-.5,s,n)}catch(u){window.console&&window.console.error(u+" Area: "+i*s+","+o*n+","+s+","+n)}t.restore(),_chljs.screenDebug&&e.drawSprite(t)}else window.console&&window.console.error("Data missing in SpriteSheet.drawSprite(ctx,spr[,col,row,offsetX,offsetY])")},this.drawSpriteFromArea=function(t,e,i,s,n,o,r,h){if(void 0!==o){r=isNaN(r)?0:r,h=isNaN(h)?0:h;var a=e.hflip?-1:1,l=e.vflip?-1:1;t.save(),t.translate(e.x+r-World.cam.x,e.y+h-World.cam.y),t.rotate(e.rotation*Math.DEG),t.scale(e.scale*a,e.scale*l);try{t.drawImage(this.img,i,s,n,o,n*-.5,o*-.5,n,o)}catch(c){window.console&&window.console.error(c+" Area: "+i+","+s+","+n+","+o)}t.restore(),_chljs.screenDebug&&e.drawSprite(t)}else window.console&&window.console.error("Data missing in SpriteSheet.drawSprite(ctx, spr, areaX, areaY, areaWidth, areaHeight[, offsetX, offsetY])")}}function SpriteVector(){}Math.DEG=Math.PI/180,Array.prototype.insert=function(t,e){this.splice(t,0,e)},Array.prototype.remove=function(t){return this.splice(t,1)[0]},Array.prototype.removeAll=function(){this.length=0};var _chljs={buffer:null,view:null,fullMode:0,viewScale:1,offsetTop:0,offsetLeft:0,isFullscreen:!1,screenDebug:!1,currentScene:0,scenes:[],runnable:[]};Button.prototype={up:function(){return this.x>=Input.mouse.x&&this.x+this.width<=Input.mouse.x&&this.y>=Input.mouse.y&&this.y+this.height<=Input.mouse.y},over:function(){return this.x<Input.mouse.x&&this.x+this.width>Input.mouse.x&&this.y<Input.mouse.y&&this.y+this.height>Input.mouse.y},down:function(){return Input.pressing[1]&&this.x<Input.mouse.x&&this.x+this.width>Input.mouse.x&&this.y<Input.mouse.y&&this.y+this.height>Input.mouse.y},hit:function(){return 1===Input.lastRelease&&this.x<Input.mouse.ox&&this.x+this.width>Input.mouse.ox&&this.y<Input.mouse.oy&&this.y+this.height>Input.mouse.oy&&this.x<Input.mouse.x&&this.x+this.width>Input.mouse.x&&this.y<Input.mouse.y&&this.y+this.height>Input.mouse.y},touch:function(){var t=0,e=0;for(t=0,e=Input.touches.length;e>t;t+=1)if(this.x<Input.touches[t].x&&this.x+this.width>Input.touches[t].x&&this.y<Input.touches[t].y&&this.y+this.height>Input.touches[t].y)return!0;return!1},tap:function(){if(1===Input.lastPress){var t=0,e=0;for(t=0,e=Input.touches.length;e>t;t+=1)if(this.x<Input.touches[t].x&&this.x+this.width>Input.touches[t].x&&this.y<Input.touches[t].y&&this.y+this.height>Input.touches[t].y)return!0}return!1},draw:function(t,e,i,s){void 0!==t?(void 0!==e&&(i=isNaN(i)?0:i,s=isNaN(s)?0:s,t.drawImage(e,this.x+World.cam.x+i,this.y+World.cam.y+s)),(_chljs.screenDebug||void 0===e||0===e.naturalWidth)&&(t.strokeStyle=this.over()?Input.pressing[1]?"#fff":"#0ff":"#00f",t.strokeRect(this.x+World.cam.x,this.y+World.cam.y,this.width,this.height))):window.console&&window.console.error("Data missing in Button.draw(ctx[, img, offsetX, offsetY])")}},Camera.prototype={x:0,y:0,focus:function(t,e,i,s){if(void 0!==t){e=isNaN(e)?0:e,i=isNaN(i)?0:i,s=isNaN(s)?i:s;var n=~~(t.x-_chljs.view.width/2),o=~~(t.y-_chljs.view.height/2);World.width<_chljs.view.width||World.width-2*i<_chljs.view.width?this.x=World.width/2-_chljs.view.width/2:(e&&Math.abs(n-this.x)>e?n>this.x?this.x+=e:this.x-=e:this.x=n,this.keepInWorld&&!World.loopX&&(this.x<i?this.x=i:this.x>World.width-_chljs.view.width-i&&(this.x=World.width-_chljs.view.width-i))),World.height<_chljs.view.height||World.height-2*s<_chljs.view.height?this.y=World.height/2-_chljs.view.height/2:(e&&Math.abs(o-this.y)>e?o>this.y?this.y+=e:this.y-=e:this.y=o,this.keepInWorld&&!World.loopY&&(this.y<s?this.y=s:this.y>World.height-_chljs.view.height-s&&(this.y=World.height-_chljs.view.height-s)))}else window.console&&window.console.error("Data missing in Camera.focus(spr[, slide, offsetX, offsetY])")}},Particle.prototype={Particle:function(t,e,i,s,n,o,r,h){if(void 0!==r){if(this.x=t,this.y=e,this.ox=t,this.oy=e,this.diameter=i+1,this.life=s,this.olife=s,this.speed=n,this.angle=o,this.rotation=o,this.color=r,void 0!==h){var a=this._hex2rgb(r),l=this._hex2rgb(h),c=~~((a[0]-l[0])/(1e3*s+1)),u=~~((a[1]-l[1])/(1e3*s+1)),d=~~((a[2]-l[2])/(1e3*s+1)),f=0;for(f=0;1e3*s>f;f+=1)this.colorList.push("rgb("+(a[0]-f*c)+","+(a[1]-f*u)+","+(a[2]-f*d)+")")}return!0}return window.console&&window.console.error("Data missing in Particle(x, y, diameter, life, speed, angle, colorStart[, colorEnd])"),!1},_hex2rgb:function(t){if("#"===t.charAt(0)){var e=[];return t=t.substring(1,7),3===t.length?(e[0]=17*parseInt(t.charAt(0),16),e[1]=17*parseInt(t.charAt(1),16),e[2]=17*parseInt(t.charAt(2),16)):(e[0]=parseInt(t.substr(0,2),16),e[1]=parseInt(t.substr(2,2),16),e[2]=parseInt(t.substr(4,2),16)),e}return window.console&&window.console.log("Error: Color is not hexadecimal"),[0,0,0]}},ParticleSystem.prototype=[],ParticleSystem.prototype.addParticle=function(t,e,i,s,n,o,r,h){this.push("object"==typeof t?t:new Particle(t,e,i,s,n,o,r,h))},ParticleSystem.prototype.drawParticles=function(t,e,i){var s=0,n=0;if(void 0!==i)for(s=0,n=this.length;n>s;s+=1)t.save(),e&&(t.globalAlpha=this[s].life/this[s].olife),t.translate(this[s].x-World.cam.x,this[s].y-World.cam.y),t.rotate(this[s].rotation*Math.DEG),t.drawImage(i,i.width*-.5,i.height*-.5),t.restore();else if(void 0!==t)for(s=0,n=this.length;n>s;s+=1)t.fillStyle=this[s].color,t.save(),e&&(t.globalAlpha=this[s].life/this[s].olife),t.beginPath(),t.arc(this[s].x-World.cam.x,this[s].y-World.cam.y,this[s].diameter/2,0,2*Math.PI,!0),t.closePath(),t.fill(),t.restore();else window.console&&window.console.error("Data missing in ParticleSystem.drawParticles(ctx[, img, alpha])")},ParticleSystem.prototype.drawParticlesO=function(t,e){if(void 0!==t){var i=0,s=0;for(i=0,s=this.length;s>i;i+=1)t.strokeStyle=this[i].color,t.fillStyle=this[i].color,t.save(),e&&(t.globalAlpha=this[i].life/this[i].olife),t.beginPath(),t.moveTo(this[i].ox,this[i].oy),t.lineTo(this[i].x,this[i].y),t.closePath(),t.stroke(),t.beginPath(),t.arc(this[i].x-World.cam.x,this[i].y-World.cam.y,this[i].diameter/2,0,2*Math.PI,!0),t.closePath(),t.fill(),t.restore()}else window.console&&window.console.error("Data missing in ParticleSystem.drawParticles0(ctx[, alpha])")},ParticleSystem.prototype.update=function(t){t=void 0===t?1:t;var e=0,i=0;for(e=0,i=this.length;i>e;e+=1)this[e].life-=t,this[e].life>0?(this.moveOrigin&&(this[e].ox=this[e].x,this[e].oy=this[e].y),this[e].x+=(this[e].speed*Math.cos(this[e].angle*Math.DEG)+this.wind*(this[e].olife-this[e].life))*t,this[e].y+=(this[e].speed*Math.sin(this[e].angle*Math.DEG)+this.gravity*(this[e].olife-this[e].life))*t,this[e].colorList.length>0&&(this[e].color=this[e].colorList.shift())):(this.remove(e),e-=1,i-=1)},Scene.prototype={load:function(){},act:function(){},paint:function(t){t.fillText("Scene "+this.id,20,30)}},Sprite.prototype={get left(){return this.x-this.getWidth()/2},set left(t){this.x=t+this.getWidth()/2},get right(){return this.x+this.getWidth()/2},set right(t){this.x=t-this.getWidth()/2},get top(){return this.y-this.getHeight()/2},set top(t){this.y=t+this.getHeight()/2},get bottom(){return this.y+this.getHeight()/2},set bottom(t){this.y=t-this.getHeight()/2},setOrigin:function(t,e){void 0!==e?(this.ox=t,this.oy=e):window.console&&window.console.error("Data missing in Sprite.setOrigin(x, y)")},setHealth:function(t){void 0!==t?(this.ohealth=t,this.health=t):window.console&&window.console.error("Data missing in Sprite.setHealth(health)")},setPosition:function(t,e){void 0!==e?(this.x=t,this.y=e):window.console&&window.console.error("Data missing in Sprite.setPosition(x, y)")},resetPosition:function(){this.x=this.ox,this.y=this.oy},reset:function(){this.x=this.ox,this.y=this.oy,this.health=this.ohealth,this.vx=0,this.vy=0,this.rotation=0,this.scale=1},move:function(t){t=void 0===t?1:t,this.x+=this.vx*t,this.y+=this.vy*t},setDirection:function(t,e){void 0!==e?(this.vx=e*Math.cos(t*Math.DEG),this.vy=e*Math.sin(t*Math.DEG)):window.console&&window.console.error("Data missing in Sprite.setDirection(angle, speed)")},getAngle:function(t){var e=0;return e=void 0!==t?Math.atan2(this.y-t.y,this.x-t.x)/Math.DEG+90:Math.atan2(this.vy,this.vx)/Math.DEG,e>360&&(e-=360),0>e&&(e+=360),e},getSpeed:function(){return this.vx/Math.cos(Math.DEG*this.getAngle())},getWidth:function(){return this.width*this.scale},getHeight:function(){return this.height*this.scale},getDiameter:function(t){return void 0!==t&&t?Math.min(this.width,this.height)*this.scale:Math.max(this.width,this.height)*this.scale},distance:function(t,e){if(void 0!==t){var i=this.x-t.x,s=this.y-t.y;return Math.sqrt(i*i+s*s)-(this.getDiameter(e)/2+t.getDiameter(e)/2)}return window.console&&window.console.error("Data missing in Sprite.distance(spr[, inner])"),!1},contains:function(t,e,i,s){if(void 0!==t){var n=t;if("object"==typeof t)n=t.x||0,e=t.y||0,i=t.width||0,s=t.height||0;else{if(void 0===e)return window.console&&window.console.error("Data missing in Sprite.contains(x, y[, width, height])"),!1;i=i||0,s=s||0}return this.left<n+i&&this.right>n+i&&this.top<e+s&&this.bottom>e+s}return window.console&&window.console.error("Data missing in Sprite.contains(rect)"),!1},intersects:function(t,e,i,s){if(void 0!==t){var n=t;if("object"==typeof t)n=t.x||0,e=t.y||0,i=t.width||0,s=t.height||0;else if(void 0===s)return window.console&&window.console.error("Data missing in Sprite.intersects(x, y, width, height)"),!1;return this.left<n+i&&this.right>n&&this.top<e+s&&this.bottom>e}return window.console&&window.console.error("Data missing in Sprite.intersects(rect)"),!1},collisionCircle:function(t,e){return void 0!==t?this.distance(t,e)<0:(window.console&&window.console.error("Data missing in Sprite.collisionCircle(spr[, inner])"),!1)},collisionPoint:function(t,e){return void 0!==e?this.contains(t,e):(window.console&&window.console.error("Data missing in Sprite.collisionPoint(x, y)"),!1)},collisionBox:function(t,e,i){return void 0!==t?void 0!==i?t.contains(this.x+e,this.y+i):this.intersects(t.left,t.top,t.getWidth(),t.getHeight()):(window.console&&window.console.error("Data missing in Sprite.collisionBox(spr[, hotspotX, hotspotY])"),!1)},collisionMap:function(t,e,i,s){var n=0,o=0;for(isNaN(e)||(e+=this.x),isNaN(i)||(i+=this.y),n=1,o=World.map.length;o>n;n+=1){var r=World.map[n];if((void 0!==t?t===r.type:!0)&&(void 0!==s?s!==n:!0)&&(e||this.left)<r.right&&(e||this.right)>r.left&&(i||this.top)<r.bottom&&(i||this.bottom)>r.top)return n}return 0},collisionMapClosest:function(t,e,i){var s=0,n=this.getDiameter()/2,o=0,r=0;for(isNaN(e)||(e+=this.x),isNaN(i)||(i+=this.y),o=1,r=World.map.length;r>o;o+=1){var h=World.map[o];if((void 0!==t?t===h.type:!0)&&(e||this.left)<h.right&&(e||this.right)>h.left&&(i||this.top)<h.bottom&&(i||this.bottom)>h.top){var a=this.distance(World.map[o]);n>a&&(s=o,n=a)}}return s},collisionMapFunction:function(t){if("function"==typeof t){var e=0,i=0;for(e=1,i=World.map.length;i>e;e+=1){var s=World.map[e];this.left<s.right&&this.right>s.left&&this.top<s.bottom&&this.bottom>s.top&&t(s)}}else window.console&&window.console.error("Data missing in Sprite.collisionMapfunction (function)")},collisionMapRange:function(t,e,i,s,n){if(isNaN(i)||(i+=this.x),isNaN(s)||(s+=this.y),void 0!==e){var o=0,r=0;for(o=1,r=World.map.length;r>o;o+=1){var h=World.map[o];if((void 0!==n?n!==o:!0)&&h.type>=t&&h.type<=e&&(i||this.left)<h.right&&(i||this.right)>h.left&&(s||this.top)<h.bottom&&(s||this.bottom)>h.top)return o}return 0}return window.console&&window.console.error("Data missing in Sprite.collisionMapRange(typeMin, typeMax[, hotspotX, hotspotY, exception])"),!1},collisionMapSwitch:function(t,e,i,s,n){if(isNaN(i)||(i+=this.x),isNaN(s)||(s+=this.y),void 0!==e){var o=!1,r=0,h=0;for(r=1,h=World.map.length;h>r;r+=1){var a=World.map[r];(void 0!==n?n!==r:!0)&&(void 0!==t?t===a.type:!0)&&(i||this.left)<a.right&&(i||this.right)>a.left&&(s||this.top)<a.bottom&&(s||this.bottom)>a.top&&(e>0?a.type=e:(World.map.remove(r),r-=1,h-=1),o=!0)}return o}return window.console&&window.console.error("Data missing in Sprite.collisionMapSwitch(type, newType[, hotspotX, hotspotY, exception])"),!1},drawSprite:function(t,e,i,s){if(void 0!==t){if(void 0!==e){i=isNaN(i)?0:i,s=isNaN(s)?0:s;var n=this.hflip?-1:1,o=this.vflip?-1:1;t.save(),t.translate(this.x+i-World.cam.x,this.y+s-World.cam.y),t.rotate(this.rotation*Math.DEG),t.scale(this.scale*n,this.scale*o),t.drawImage(e,e.width*-.5,e.height*-.5),t.restore()}(_chljs.screenDebug||void 0===e||0===e.naturalWidth)&&(t.strokeStyle="#fff",t.beginPath(),t.moveTo(this.left-World.cam.x,this.y-World.cam.y),t.lineTo(this.right-World.cam.x,this.y-World.cam.y),t.moveTo(this.x-World.cam.x,this.top-World.cam.y),t.lineTo(this.x-World.cam.x,this.bottom-World.cam.y),t.stroke(),t.strokeStyle="#0f0",t.strokeRect(this.left-World.cam.x,this.top-World.cam.y,this.width*this.scale,this.height*this.scale),t.strokeStyle="#0ff",t.beginPath(),t.arc(this.x-World.cam.x,this.y-World.cam.y,Math.min(this.width,this.height)*this.scale/2,0,2*Math.PI,!0),t.closePath(),t.stroke(),t.strokeStyle="#00f",t.beginPath(),t.arc(this.x-World.cam.x,this.y-World.cam.y,Math.max(this.width,this.height)*this.scale/2,0,2*Math.PI,!0),t.closePath(),t.stroke())}else window.console&&window.console.error("Data missing in Sprite.drawSprite(ctx[, img, offsetX, offsetY])");return!1}},SpriteVector.prototype=[],SpriteVector.prototype.addSprite=function(t,e,i,s,n){void 0!==t?this.push("object"==typeof t?t:new Sprite(t,e,i,s,n)):window.console&&window.console.error("Data missing in SpriteVector.addSprite(sprite)")},SpriteVector.prototype.addMap=function(t,e,i,s,n){if(void 0!==e){i=void 0===i?e:i;var o=void 0===s?t.shift():s,r=0,h=0;for(r=0,h=t.length;h>r;r+=1)if(t[r]>0){var a;void 0!==n?(a=new Sprite(n[t[r]]),a.setOrigin(r%o*e+e/2,~~(r/o)*i+i/2),a.resetPosition()):a=new Sprite(r%o*e+e/2,~~(r/o)*i+i/2,e,i),a.type=t[r],this.addSprite(a)}s&&t.unshift(o)}else window.console&&window.console.error("Data missing in SpriteVector.addMap(map, width[, height, cols, masterSprites])")},SpriteVector.prototype.getSprite=function(t){return this[t]},SpriteVector.prototype.move=function(t){var e=0,i=0;for(e=0,i=this.length;i>e;e+=1)this[e].move(t)},SpriteVector.prototype.contains=function(t,e,i,s){if(void 0!==t){var n=0,o=0;for(n=1,o=this.length;o>n;n+=0)if(this[n].contains(t,e,i,s))return n}else window.console&&window.console.error("Data missing in SpriteVector.contains(rect)");return 0},SpriteVector.prototype.intersects=function(t,e,i,s){if(void 0!==t){var n=0,o=0;for(n=1,o=this.length;o>n;n+=0)if(this[n].intersects(t,e,i,s))return n}else window.console&&window.console.error("Data missing in SpriteVector.intersects(rect)");return 0},SpriteVector.prototype.collisionBox=function(t){if(void 0!==t){var e=0,i=0;for(e=0,i=this.length;i>e;e+=0)if(this[e].collisionBox(t))return!0}else window.console&&window.console.error("Data missing in SpriteVector.collisionBox(spr)");return!1},SpriteVector.prototype.drawSprites=function(t,e,i,s){var n=0,o=0;for(n=0,o=this.length;o>n;n+=1){var r;r=void 0!==e&&e instanceof Array?e[this[n].type]:e,this[n].drawSprite(t,r,i,s)}};var Input=new function(){function t(t,e,i){this.id=t||0,this.x=e||0,this.y=i||0,this.ox=this.x,this.oy=this.y,this.draw=function(t){void 0!==t?(t.strokeStyle="#999",t.beginPath(),t.arc(this.x,this.y,10,0,2*Math.PI,!0),t.moveTo(this.x,this.y),t.lineTo(this.ox,this.oy),t.stroke()):window.console&&window.console.error("Data missing in Input.touch["+this.id+"].draw(ctx)")}}function e(t){return _chljs.isFullscreen&&2===_chljs.fullMode?~~(t*_chljs.view.width/window.innerWidth):~~(~~(t+document.documentElement.scrollLeft-(_chljs.offsetLeft||_chljs.buffer.offsetLeft))/_chljs.viewScale)}function i(t){return _chljs.isFullscreen&&2===_chljs.fullMode?~~(t*_chljs.view.height/window.innerHeight):~~(~~(t+document.documentElement.scrollTop-(_chljs.offsetTop||_chljs.buffer.offsetTop))/_chljs.viewScale)}function s(t){Input.acceleration.x=t.accelerationIncludingGravity.x,Input.acceleration.y=t.accelerationIncludingGravity.y,Input.acceleration.z=t.accelerationIncludingGravity.z}function n(t){Input.orientation.absolute=t.absolute,Input.orientation.alpha=t.alpha,Input.orientation.beta=t.beta,Input.orientation.gamma=t.gamma}function o(t){Input.pressing[t.keyCode]||(Input.lastPress=t.keyCode),Input.pressing[t.keyCode]=!0,Input.lastPress>=37&&Input.lastPress<=40&&t.preventDefault()}function r(t){Input.lastRelease=t.keyCode,Input.pressing[t.keyCode]=!1}function h(t){t.stopPropagation(),t.preventDefault()}function a(e){h(e),Input.lastPress=e.which,Input.pressing[e.which]=!0,1===e.which&&(Input.mouse.ox=Input.mouse.x,Input.mouse.oy=Input.mouse.y),0===Input.touches.length&&(Input.touches.push(new t(0,Input.mouse.x,Input.mouse.y)),Input.lastTouchPress=0)}function l(t){Input.lastRelease=t.which,Input.pressing[t.which]=!1,Input.touches.length>0&&(Input.touches.length=0,Input.lastTouchRelease=0)}function c(t){Input.mouse.move=!0,Input.mouse.x=e(t.pageX),Input.mouse.y=i(t.pageY),Input.touches.length>0&&(Input.touches[0].x=Input.mouse.x,Input.touches[0].y=Input.mouse.y)}function u(s){s.preventDefault();var n=s.changedTouches,o=0,r=0;for(o=0,r=n.length;r>o;o+=0)Input.touches.push(new t(n[o].identifier,e(n[o].pageX),i(n[o].pageY))),Input.lastTouchPress=n[o].identifier;Input.pressing[1]||(Input.lastPress=1),Input.pressing[1]=!0,Input.mouse.ox=Input.touches[0].x,Input.mouse.oy=Input.touches[0].y,Input.mouse.move=!0,Input.mouse.x=Input.mouse.ox,Input.mouse.y=Input.mouse.oy}function d(t){t.preventDefault();var e=t.changedTouches,i=0,s=0,n=0,o=0;for(i=0,n=e.length;n>i;i+=1)for(s=0,o=Input.touches.length;o>s;s+=1)Input.touches[s].id===e[i].identifier&&(Input.touches.remove(s),Input.lastTouchRelease=e[i].identifier,s-=1,o-=1);Input.lastRelease=1,Input.pressing[1]=!1}function f(t){t.preventDefault();var s=t.targetTouches,n=0,o=0,r=0,h=0;for(n=0,r=s.length;r>n;n+=1)for(o=0,h=Input.touches.length;h>o;o+=1)Input.touches[o].id===s[n].identifier&&(Input.touches[o].x=e(s[n].pageX),Input.touches[o].y=i(s[n].pageY));Input.mouse.move=!0,Input.mouse.x=Input.touches[0].x,Input.mouse.y=Input.touches[0].y}this.lastPress=null,this.lastTouchPress=null,this.lastTouchRelease=null,this.pressing=[],this.touches=[],this.acceleration={active:!1,x:0,y:0,z:0},this.mouse={x:0,y:0,ox:0,oy:0,move:!1,draw:function(t){void 0!==t?(t.strokeStyle=Input.pressing[1]?"#fff":"#f00",t.beginPath(),t.arc(this.x,this.y,5,0,2*Math.PI,!0),t.moveTo(this.x-5,this.y),t.lineTo(this.x+5,this.y),t.moveTo(this.x,this.y-5),t.lineTo(this.x,this.y+5),Input.pressing[1]&&(t.moveTo(this.x,this.y),t.lineTo(this.ox,this.oy)),t.closePath(),t.stroke()):window.console&&window.console.error("Data missing in Input.mouse.draw(ctx)")}},this.orientation={active:!1,absolute:!1,alpha:0,beta:0,gamma:0},this.enableAcceleration=function(){window.DeviceMotionEvent?(this.acceleration.active=!0,window.addEventListener("devicemotion",s,!1)):window.console&&window.console.error("Device motion not supported")},this.enableKeyboard=function(){document.addEventListener("keydown",o,!1),document.addEventListener("keyup",r,!1)},this.enableMouse=function(){_chljs.buffer.addEventListener("contextmenu",h,!1),_chljs.buffer.addEventListener("mousedown",a,!1),document.addEventListener("mouseup",l,!1),document.addEventListener("mousemove",c,!1)},this.enableOrientation=function(){window.DeviceOrientationEvent?(this.orientation.active=!0,window.addEventListener("deviceorientation",n,!1)):window.console&&window.console.error("Device orientation not supported")},this.enableTouch=function(){_chljs.buffer.addEventListener("touchstart",u,!1),_chljs.buffer.addEventListener("touchend",d,!1),_chljs.buffer.addEventListener("touchcancel",d,!1),_chljs.buffer.addEventListener("touchmove",f,!1)},this.disableAcceleration=function(){window.removeEventListener("devicemotion",s,!1),this.acceleration.active=!1},this.disableKeyboard=function(){document.removeEventListener("keydown",o,!1),document.removeEventListener("keyup",r,!1)},this.disableMouse=function(){_chljs.buffer.removeEventListener("contextmenu",h,!1),_chljs.buffer.removeEventListener("mousedown",a,!1),document.removeEventListener("mouseup",l,!1),document.removeEventListener("mousemove",c,!1)},this.disableOrientation=function(){window.removeEventListener("deviceorientation",n,!1),this.orientation.active=!1},this.disableTouch=function(){_chljs.buffer.removeEventListener("touchstart",u,!1),_chljs.buffer.removeEventListener("touchend",d,!1),_chljs.buffer.removeEventListener("touchcancel",d,!1),_chljs.buffer.removeEventListener("touchmove",f,!1)},this.virtualKey=function(t,e){void 0!==e?(e?this.pressing[t]||(this.lastPress=t):this.pressing[t]&&(this.lastRelease=t),this.pressing[t]=e):window.console&&window.console.error("Data missing in Input.virtualKey(key, action)")}},Toast={text:"",time:0,offset:0,makeText:function(t,e){void 0!==e?(this.text=t,this.time=e,this.offset=0):window.console&&window.console.error("Data missing in Toast.makeText(string, time)")},update:function(t){this.time>0&&(this.time-=t)},paint:function(t){if(this.time>0){t.font="10px sans-serif",t.textAlign="center",0===this.offset&&(this.offset=t.measureText(this.text).width/2),this.time<1&&(t.globalAlpha=this.time);var e=_chljs.view.width/2,i=_chljs.view.height;t.fillStyle="#333",t.beginPath(),t.rect(e-this.offset,i-20,2*this.offset,16),t.beginPath(),t.arc(e-this.offset,i-12,8,1.5*Math.PI,.5*Math.PI,!0),t.arc(e+this.offset,i-12,8,.5*Math.PI,1.5*Math.PI,!0),t.fill(),t.fillStyle="#ccc",t.fillText(this.text,e,i-8),t.globalAlpha=1,t.textAlign="left"
}}},Util={getAngle:function(t,e,i,s){if(void 0!==s){var n=Math.atan2(e-s,t-i)/Math.DEG+90;return n>360&&(n-=360),0>n&&(n+=360),n}window.console&&window.console.error("Data missing in Util.getAngle(x1, y1, x2, y2)")},getDistance:function(t,e,i,s){if(void 0!==s){var n=t-i,o=e-s;return Math.sqrt(n*n+o*o)}window.console&&window.console.error("Data missing in Util.getDistance(x1, y1, x2, y2)")},getImage:function(t){var e=new Image;return void 0!==t&&(e.src=t),e},getAudio:function(t){var e=new Audio;return void 0!==t&&(e.src=e.canPlayType("audio/ogg").replace(/no/,"")?t.substr(0,t.lastIndexOf("."))+".oga":t),e},fillTile:function(t,e,i,s,n,o){if(void 0!==e){if(e.width>0&&e.height>0){i=isNaN(i)?0:i,s=isNaN(s)?0:s;var r=0,h=0;if(n=void 0===n?!0:n,o=void 0===o?!0:o,n)for(r=~~(i/e.width)*e.width,i>0&&(r+=e.width);i-r<_chljs.view.width;){if(o)for(h=~~(s/e.height)*e.height,s>0&&(h+=e.height);s-h<_chljs.view.height;)t.drawImage(e,i-r,s-h),h-=e.height;else t.drawImage(e,i-r,s-h);r-=e.width}else if(o)for(h=~~(s/e.height)*e.height,0>s&&(h-=e.height);s-h<_chljs.view.height;)t.drawImage(e,i-r,s-h),h-=e.height;else t.drawImage(e,i-r,s-h)}}else window.console&&window.console.error("Data missing in Util.fillTile(ctx, img[, x, y, repeatX, repeatY])")},random:function(t){return Math.random()*t}},World={width:0,height:0,map:new SpriteVector,cam:new Camera,loopX:!1,loopY:!1,setMap:function(t,e,i,s){if(void 0!==e){i=void 0===i?e:i;var n=void 0===s?t.shift():s;this.width=n*e,this.height=Math.ceil(t.length/n)*i,this.map.length=0,this.map.push(new Sprite(0,0,0)),this.map.addMap(t,e,i,n),s&&t.unshift(n)}else window.console&&window.console.error("Data missing in World.setMap(map, cols, width[, height])")},setSize:function(t,e){void 0!==e?(this.width=t,this.height=e):window.console&&window.console.error("Data missing in World.setSize(width, height)")},drawMap:function(t,e){if(void 0!==t){var i=0,s=0;for(t.strokeStyle="#f00",t.fillStyle="#f00",i=1,s=this.map.length;s>i;i+=1){var n=this.map[i];if(void 0!==e)if(e instanceof SpriteSheet)e.draw(t,n.left-this.cam.x,n.top-this.cam.y,n.type+n.mapOffset),this.loopX&&(this.cam.x<0?e.draw(t,n.left-this.width-this.cam.x,n.top-this.cam.y,n.type+n.mapOffset):e.draw(t,n.left+this.width-this.cam.x,n.top-this.cam.y,n.type+n.mapOffset)),this.loopY&&(this.cam.y<0?e.draw(t,n.left-this.cam.x,n.top-this.height-this.cam.y,n.type+n.mapOffset):e.draw(t,n.left-this.cam.x,n.top+this.height-this.cam.y,n.type+n.mapOffset));else{var o;o=e instanceof Array?e[n.type+n.mapOffset]:e,t.drawImage(o,n.left-this.cam.x,n.top-this.cam.y),this.loopX&&(this.cam.x<0?t.drawImage(o,n.left-this.width-this.cam.x,n.top-this.cam.y):t.drawImage(o,n.left+this.width-this.cam.x,n.top-this.cam.y)),this.loopY&&(this.cam.y<0?t.drawImage(o,n.left-this.cam.x,n.top-this.height-this.cam.y):t.drawImage(o,n.left-this.cam.x,n.top+this.height-this.cam.y))}(_chljs.screenDebug||void 0===e||0===e.naturalWidth)&&(t.strokeRect(n.left-this.cam.x,n.top-this.cam.y,n.width,n.height),t.fillText(i,n.left-this.cam.x,n.top+n.width-this.cam.y))}if(_chljs.screenDebug){for(t.strokeStyle="#999",t.strokeRect(-this.cam.x,-this.cam.y,this.width,this.height),i=0,s=Input.touches.length;s>i;i+=1)Input.touches[i].draw(t);Input.mouse.draw(t)}}else window.console&&window.console.error("Data missing in World.drawMap(ctx[, img, imagesPerRow])")}};
//# sourceMappingURL=chloe.js.map